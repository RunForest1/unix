services:
  redis:
    image: redis:alpine
    ports: [ "6379:6379" ]

  nginx:
    image: nginx:alpine
    ports: [ "80:80" ]
    volumes: [ "./nginx.conf:/etc/nginx/nginx.conf" ]
    depends_on: [ api ]

  api:
    build: ./api
    environment:
      - REDIS_URL=redis://redis:6379
    depends_on: [ redis ]
    scale: 3

  worker:
    build: ./worker
    environment:
      - REDIS_URL=redis://redis:6379
    depends_on: [ redis ]
    scale: 2
